<!DOCTYPE html>
<html>
<head>
  <title>Kasyno Online</title>

  <!-- Tokeny CSRF (ochrona przed faÅ‚szywymi Å¼Ä…daniami POST) -->
  <%= csrf_meta_tags %>

  <!-- Polityka bezpieczeÅ„stwa treÅ›ci (CSP) -->
  <%= csp_meta_tag %>

  <!-- GÅ‚Ã³wny arkusz CSS z Rails (z Turbo do odÅ›wieÅ¼ania stylÃ³w po zmianie) -->
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>

  <!-- ZewnÄ™trzny skrypt Chart.js do wykresÃ³w -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Åadowanie plikÃ³w JS przez importmap (Rails 7) -->
  <%= javascript_importmap_tags %>
</head>

<body>
<!-- NagÅ‚Ã³wek strony z tytuÅ‚em i nawigacjÄ… -->
<header>
  <h1>ğŸ° Kasyno Online ğŸ°</h1>
  <nav>
    <%= link_to "ğŸ  Strona gÅ‚Ã³wna", root_path %> |
    <%= link_to "Blackjack â™ ï¸", blackjack_path %> |
    <%= link_to "Ruletka ğŸ²", roulette_path %> |
    <%= link_to "JednorÄ™ki bandyta ğŸ°", slots_path %>
  </nav>
</header>

<!-- Panel uÅ¼ytkownika widoczny tylko, jeÅ›li uÅ¼ytkownik jest zalogowany -->
<% if current_user %>
  <div class="user-panel">
    <!-- Przycisk rozwijajÄ…cy menu uÅ¼ytkownika z awatarem -->
    <button id="user-toggle" class="user-button">
      <%= image_tag(
            current_user.avatar.attached? ? url_for(current_user.avatar) : asset_path("default_avatar.png"),
            class: "user-avatar"
          ) %>
      <span class="user-name"><%= current_user.username || current_user.email %></span>
      â·
    </button>

    <!-- Menu uÅ¼ytkownika (saldo, linki do konta, edycji, wylogowania) -->
    <div id="user-menu" class="user-menu hidden">
      <!-- Saldo aktualizowane przez Turbo Frame -->
      <turbo-frame id="user-balance">
        <p>ğŸ’° Saldo: <%= current_user.wallet&.balance || 0 %> Å¼etonÃ³w</p>
      </turbo-frame>
      <%= link_to "ğŸ‘¤ Moje konto", account_path, class: "user-link" %>
      <%= link_to "âš™ï¸ Edytuj profil", edit_user_registration_path, class: "user-link" %>
      <%= button_to "ğŸšª Wyloguj", destroy_user_session_path, method: :delete, data: { turbo: false }, class: "user-link" %>
    </div>
  </div>
<% else %>
  <!-- Link do logowania, gdy uÅ¼ytkownik nie jest zalogowany -->
  <div class="user-panel">
    <%= link_to "ğŸ”‘ Zaloguj", new_user_session_path, class: "user-login" %>
  </div>
<% end %>

<!-- GÅ‚Ã³wna treÅ›Ä‡ strony -->
<main>
  <%= yield %> <!-- Tu Å‚adowane sÄ… widoki stron -->
</main>

<!-- Stopka -->
<footer>
  <p>&copy; 2025 Kasyno Online</p>
</footer>

<!-- Skrypt JS do rozwijania/zamykania menu uÅ¼ytkownika -->
<script>
    console.log("ğŸš€ JS zaÅ‚adowany");

    document.addEventListener("turbo:load", function () {
        const toggle = document.getElementById("user-toggle");
        const menu = document.getElementById("user-menu");

        if (toggle && menu) {
            toggle.addEventListener("click", () => {
                menu.classList.toggle("show");
                menu.classList.toggle("hidden");
            });

            // Zamykanie menu po klikniÄ™ciu poza nim
            document.addEventListener("click", function (e) {
                if (!toggle.contains(e.target) && !menu.contains(e.target)) {
                    menu.classList.add("hidden");
                    menu.classList.remove("show");
                }
            });
        }
    });
</script>
</body>
</html>
